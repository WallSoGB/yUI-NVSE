#pragma once

#include "BSSimpleList.hpp"
#include "BSString.hpp"
#include "BSFile.hpp"
#include "NiTPointerMap.hpp"

class TESObjectCELL;
class TESForm;

struct ChunkAndFormType {
	uint32_t	chunkType;	// ie
	uint32_t	formType;	// ie 0x2A
	const char* formName;	// ie 'NPC_'
};

struct ChunkHeader {
	uint32_t	type : 4;	// i.e. 'XGRD', 'DATA'
	uint16_t	size : 2;
};

enum CHUNK_ID {
	NO_CHUNK	= 0x0,
	ACBS_ID		= 0x53424341,
	ACEC_ID		= 0x43454341,
	ACEP_ID		= 0x50454341,
	ACID_ID		= 0x44494341,
	ACPR_ID		= 0x52504341,
	ACSR_ID		= 0x52534341,
	ACTN_ID		= 0x4E544341,
	ACTV_ID		= 0x56544341,
	ACUN_ID		= 0x4E554341,
	AGFD_ID		= 0x44464741,
	AGSC_ID		= 0x43534741,
	AGSX_ID		= 0x58534741,
	AGTY_ID		= 0x59544741,
	AHCF_ID		= 0x46434841,
	AHCM_ID		= 0x4D434841,
	AIDT_ID		= 0x54444941,
	ALCA_ID		= 0x41434C41,
	ALCC_ID		= 0x43434C41,
	ALCL_ID		= 0x4C434C41,
	ALCO_ID		= 0x4F434C41,
	ALCS_ID		= 0x53434C41,
	ALDI_ID		= 0x49444C41,
	ALDN_ID		= 0x4E444C41,
	ALEA_ID		= 0x41454C41,
	ALED_ID		= 0x44454C41,
	ALEQ_ID		= 0x51454C41,
	ALFA_ID		= 0x41464C41,
	ALFC_ID		= 0x43464C41,
	ALFD_ID		= 0x44464C41,
	ALFE_ID		= 0x45464C41,
	ALFI_ID		= 0x49464C41,
	ALFL_ID		= 0x4C464C41,
	ALFR_ID		= 0x52464C41,
	ALFV_ID		= 0x56464C41,
	ALID_ID		= 0x44494C41,
	ALLA_ID		= 0x414C4C41,
	ALLS_ID		= 0x534C4C41,
	ALMI_ID		= 0x494D4C41,
	ALNA_ID		= 0x414E4C41,
	ALNT_ID		= 0x544E4C41,
	ALPC_ID		= 0x43504C41,
	ALRT_ID		= 0x54524C41,
	ALSC_ID		= 0x43534C41,
	ALSP_ID		= 0x50534C41,
	ALST_ID		= 0x54534C41,
	ALUA_ID		= 0x41554C41,
	ANAM_ID		= 0x4D414E41,
	ANIS_ID		= 0x53494E41,
	AOR2_ID		= 0x32524F41,
	AORD_ID		= 0x44524F41,
	APGD_ID		= 0x44475041,
	APPR_ID		= 0x52505041,
	ATDM_ID		= 0x4D445441,
	ATKD_ID		= 0x444B5441,
	ATKE_ID		= 0x454B5441,
	ATKR_ID		= 0x524B5441,
	ATKS_ID		= 0x534B5441,
	ATKT_ID		= 0x544B5441,
	ATKW_ID		= 0x574B5441,
	ATTN_ID		= 0x4E545441,
	ATTR_ID		= 0x52545441,
	ATTX_ID		= 0x58545441,
	ATXT_ID		= 0x54585441,
	AVFL_ID		= 0x4C465641,
	AVIT_ID		= 0x54495641,
	AVMG_ID		= 0x474D5641,
	AVSK_ID		= 0x4B535641,
	BAMT_ID		= 0x544D4142,
	BCLF_ID		= 0x464C4342,
	BIDS_ID		= 0x53444942,
	BIDX_ID		= 0x58444942,
	BIPL_ID		= 0x4C504942,
	BMCT_ID		= 0x54434D42,
	BMDT_ID		= 0x54444D42,
	BMMP_ID		= 0x504D4D42,
	BNAM_ID		= 0x4D414E42,
	BOD2_ID		= 0x32444F42,
	BODT_ID		= 0x54444F42,
	BPND_ID		= 0x444E5042,
	BPNI_ID		= 0x494E5042,
	BPNN_ID		= 0x4E4E5042,
	BPNT_ID		= 0x544E5042,
	BPTF_ID		= 0x46545042,
	BPTM_ID		= 0x4D545042,
	BPTN_ID		= 0x4E545042,
	BRUS_ID		= 0x53555242,
	BSIZ_ID		= 0x5A495342,
	BSMB_ID		= 0x424D5342,
	BSMP_ID		= 0x504D5342,
	BSMS_ID		= 0x534D5342,
	BTXT_ID		= 0x54585442,
	CDIX_ID		= 0x58494443,
	CIDA_ID		= 0x41445443,
	CIS1_ID		= 0x31534943,
	CIS2_ID		= 0x32534943,
	CITC_ID		= 0x43544943,
	CLNM_ID		= 0x4D414E51,
	CLSZ_ID		= 0x5A534C43,
	CNAM_ID		= 0x4D414E43,
	CNTO_ID		= 0x4F544E43,
	COCT_ID		= 0x54434F43,
	COED_ID		= 0x44454F43,
	CRDT_ID		= 0x54445243,
	CRGR_ID		= 0x52475243,
	CRIF_ID		= 0x46495243,
	CRIS_ID		= 0x53495243,
	CRVA_ID		= 0x41565243,
	CS2D_ID		= 0x44325343,
	CS2E_ID		= 0x45325343,
	CS2F_ID		= 0x46325343,
	CS2H_ID		= 0x48325343,
	CS2K_ID		= 0x4B325343,
	CSCR_ID		= 0x52435343,
	CSCV_ID		= 0x56435343,
	CSDC_ID		= 0x43445343,
	CSDI_ID		= 0x49445343,
	CSDT_ID		= 0x54445343,
	CSFL_ID		= 0x4C465343,
	CSGD_ID		= 0x44475343,
	CSLR_ID		= 0x524C5343,
	CSME_ID		= 0x454D5343,
	CSRA_ID		= 0x41525343,
	CUSD_ID		= 0x44535543,
	CVPA_ID		= 0x41505643,
	DALC_ID		= 0x434C4144,
	DAMA_ID		= 0x414D4144,
	DAMC_ID		= 0x434D4144,
	DATA_ID		= 0x41544144,
	DELE_ID		= 0x454C4544,
	DEMO_ID		= 0x4F4D4544,
	DESC_ID		= 0x43534544,
	DEST_ID		= 0x54534544,
	DEVA_ID		= 0x41564544,
	DFTF_ID		= 0x46544644,
	DFTM_ID		= 0x4D544644,
	DMAX_ID		= 0x58414D44,
	DMDC_ID		= 0x43444D44,
	DMDL_ID		= 0x4C444D44,
	DMDS_ID		= 0x53444D44,
	DMDT_ID		= 0x54444D44,
	DMIN_ID		= 0x4E494D44,
	DMTL_ID		= 0x4C544D44,
	DNAM_ID		= 0x4D414E44,
	DODT_ID		= 0x54444F44,
	DOFT_ID		= 0x54464F44,
	DPLT_ID		= 0x544C5044,
	DSTA_ID		= 0x41545344,
	DSTD_ID		= 0x44545344,
	DSTF_ID		= 0x46545344,
	DTGT_ID		= 0x54475444,
	DTID_ID		= 0x44495444,
	EAMT_ID		= 0x544D4145,
	ECOR_ID		= 0x524F4345,
	EDID_ID		= 0x44494445,
	EFID_ID		= 0x44494645,
	EFIT_ID		= 0x54494645,
	EFSD_ID		= 0x44534645,
	EIAD_ID		= 0x444149FF,
	EITM_ID		= 0x4D544945,
	ENAM_ID		= 0x4D414E45,
	ENIT_ID		= 0x54494E45,
	EPF2_ID		= 0x32465045,
	EPF3_ID		= 0x33465045,
	EPFB_ID		= 0x42465045,
	EPFD_ID		= 0x44465045,
	EPFT_ID		= 0x54465045,
	ESAS_ID		= 0x53415345,
	ESBS_ID		= 0x53425345,
	ESCE_ID		= 0x45435345,
	ESCS_ID		= 0x53435345,
	ESHS_ID		= 0x53485345,
	ETYP_ID		= 0x50595445,
	FCHT_ID		= 0x54484346,
	FCPL_ID		= 0x4C504346,
	FGGA_ID		= 0x41474746,
	FGGS_ID		= 0x53474746,
	FGTS_ID		= 0x53544746,
	FIMD_ID		= 0x444D4946,
	FLMV_ID		= 0x564D4C46,
	FLTR_ID		= 0x52544C46,
	FLTV_ID		= 0x56544C46,
	FMIN_ID		= 0x4E494D46,
	FMRB_ID		= 0x42524D46,
	FMRC_ID		= 0x43524D46,
	FMRD_ID		= 0x44524D46,
	FMRI_ID		= 0x49524D46,
	FMRN_ID		= 0x4E524D46,
	FMRS_ID		= 0x53524D46,
	FNAM_ID		= 0x4D414E46,
	FNMK_ID		= 0x4B4D4E46,
	FNPR_ID		= 0x52504E46,
	FPRT_ID		= 0x54525046,
	FTSF_ID		= 0x46535446,
	FTSM_ID		= 0x4D535446,
	FTST_ID		= 0x54535446,
	FTYP_ID		= 0x50595446,
	FULL_ID		= 0x4C4C5546,
	FVPA_ID		= 0x41505646,
	GDRD_ID		= 0x52444757,
	GMDT_ID		= 0x54444D47,
	GNAM_ID		= 0x4D414E47,
	GREE_ID		= 0x45455247,
	GWOR_ID		= 0x524F5747,
	HCLF_ID		= 0x464C4348,
	HCLR_ID		= 0x524C4348,
	HEAD_ID		= 0x44414548,
	HEDR_ID		= 0x52444548,
	HLTX_ID		= 0x58544C48,
	HNAM_ID		= 0x4D414E48,
	HTID_ID		= 0x44495448,
	ICO2_ID		= 0x324F4349,
	ICON_ID		= 0x4E4F4349,
	IDLA_ID		= 0x414C4449,
	IDLB_ID		= 0x424C4449,
	IDLC_ID		= 0x434C4449,
	IDLF_ID		= 0x464C4449,
	IDLN_ID		= 0x4E4C4449,
	IDLT_ID		= 0x544C4449,
	IMSP_ID		= 0x50534D49,
	INAM_ID		= 0x4D414E49,
	INCC_ID		= 0x43434E49,
	INDX_ID		= 0x58444E49,
	INRD_ID		= 0x44524E49,
	INTT_ID		= 0x54544E49,
	INTV_ID		= 0x56544E49,
	IOVR_ID		= 0x52564F49,
	ISCR_ID		= 0x52435349,
	ISIZ_ID		= 0x5A495349,
	ITID_ID		= 0x44495449,
	ITMC_ID		= 0x434D5449,
	ITME_ID		= 0x454D5449,
	ITMS_ID		= 0x534D5449,
	ITXT_ID		= 0x54585449,
	JAIL_ID		= 0x4C49414A,
	JNAM_ID		= 0x4D414E4A,
	JOUT_ID		= 0x54554F4A,
	KFFZ_ID		= 0x5A46464B,
	KNAM_ID		= 0x4D414E4B,
	KWDA_ID		= 0x4144574B,
	LCEC_ID		= 0x4345434C,
	LCEP_ID		= 0x5045434C,
	LCID_ID		= 0x4449434C,
	LCPR_ID		= 0x5250434C,
	LCSR_ID		= 0x5253434C,
	LCUN_ID		= 0x4E55434C,
	LFSD_ID		= 0x4453464C,
	LFSP_ID		= 0x5053464C,
	LLCT_ID		= 0x54434C4C,
	LLKC_ID		= 0x434B4C4C,
	LLOF_ID		= 0x464F4C4C,
	LNAM_ID		= 0x4D414E4C,
	LODC_ID		= 0x43444F4C,
	LODH_ID		= 0x48444F4C,
	LODN_ID		= 0x4E444F4C,
	LODS_ID		= 0x53444F4C,
	LODT_ID		= 0x54444F4C,
	LODV_ID		= 0x56444F4C,
	LTMP_ID		= 0x504D544C,
	LTPC_ID		= 0x4350544C,
	LTPT_ID		= 0x5450544C,
	LVCR_ID		= 0x5243564C,
	LVLD_ID		= 0x444C564C,
	LVLF_ID		= 0x464C564C,
	LVLG_ID		= 0x474C564C,
	LVLM_ID		= 0x4D4C564C,
	LVLO_ID		= 0x4F4C564C,
	LVSG_ID		= 0x4753564C,
	LVSR_ID		= 0x5053564C,
	MASE_ID		= 0x4553414D,
	MAST_ID		= 0x5453414D,
	MCHT_ID		= 0x5448434D,
	MDOB_ID		= 0x424F444D,
	MHDT_ID		= 0x5444484D,
	MIC2_ID		= 0x3243494D,
	MICO_ID		= 0x4F43494D,
	MLDE_ID		= 0x45444C4D,
	MLDI_ID		= 0x49444C4D,
	MLDS_ID		= 0x53444C4D,
	MLSI_ID		= 0x49534C4D,
	MNAM_ID		= 0x4D414E4D,
	MO2C_ID		= 0x43324F4D,
	MO2F_ID		= 0x46324F4D,
	MO2S_ID		= 0x53324F4D,
	MO2T_ID		= 0x54324F4D,
	MO3C_ID		= 0x43334F4D,
	MO3F_ID		= 0x46334F4D,
	MO3S_ID		= 0x53334F4D,
	MO3T_ID		= 0x54334F4D,
	MO4C_ID		= 0x43344F4D,
	MO4F_ID		= 0x46344F4D,
	MO4S_ID		= 0x53344F4D,
	MO4T_ID		= 0x54344F4D,
	MO5C_ID		= 0x43354F4D,
	MO5F_ID		= 0x46354F4D,
	MO5S_ID		= 0x53354F4D,
	MO5T_ID		= 0x54354F4D,
	MOD2_ID		= 0x32444F4D,
	MOD3_ID		= 0x33444F4D,
	MOD4_ID		= 0x34444F4D,
	MOD5_ID		= 0x35444F4D,
	MODC_ID		= 0x43444F4D,
	MODD_ID		= 0x44444F4D,
	MODL_ID		= 0x4C444F4D,
	MODQ_ID		= 0x51444F4D,
	MODS_ID		= 0x53444F4D,
	MODT_ID		= 0x54444F4D,
	MOSD_ID		= 0x44534F4D,
	MPAI_ID		= 0x4941504D,
	MPAV_ID		= 0x5641504D,
	MPCD_ID		= 0x4443504D,
	MPGN_ID		= 0x4E47504D,
	MPGP_ID		= 0x5047504D,
	MPGS_ID		= 0x5347504D,
	MPPC_ID		= 0x4350504D,
	MPPF_ID		= 0x4650504D,
	MPPI_ID		= 0x4950504D,
	MPPK_ID		= 0x4B50504D,
	MPPM_ID		= 0x4D50504D,
	MPPN_ID		= 0x4E50504D,
	MPPS_ID		= 0x5350504D,
	MPPT_ID		= 0x5450504D,
	MPPV_ID		= 0x5650504D,
	MPRT_ID		= 0x5452504D,
	MRSV_ID		= 0x5653524D,
	MSDK_ID		= 0x4B44534D,
	MSDV_ID		= 0x5644534D,
	MSID_ID		= 0x4449534D,
	MSM0_ID		= 0x304D534D,
	MSM1_ID		= 0x314D534D,
	MSPD_ID		= 0x4450534D,
	MTNM_ID		= 0x4D4E544D,
	MTYP_ID		= 0x5059544D,
	MVRF_ID		= 0x4652564D,
	MWGT_ID		= 0x5447574D,
	MXWT_ID		= 0x5457584D,
	NAM0_ID		= 0x304D414E,
	NAM1_ID		= 0x314D414E,
	NAM2_ID		= 0x324D414E,
	NAM3_ID		= 0x334D414E,
	NAM4_ID		= 0x344D414E,
	NAM5_ID		= 0x354D414E,
	NAM6_ID		= 0x364D414E,
	NAM7_ID		= 0x374D414E,
	NAM8_ID		= 0x384D414E,
	NAM9_ID		= 0x394D414E,
	NAMA_ID		= 0x414D414E,
	NAME_ID		= 0x454D414E,
	ND3D_ID		= 0x4433444E,
	NETO_ID		= 0x4F54454E,
	NEXT_ID		= 0x5458454E,
	NIFT_ID		= 0x5446494E,
	NIFZ_ID		= 0x5A46494E,
	NNAM_ID		= 0x4D414E4E,
	NNGS_ID		= 0x53474E4E,
	NNGT_ID		= 0x54474E4E,
	NNUS_ID		= 0x53554E4E,
	NNUT_ID		= 0x54554E4E,
	NPAC_ID		= 0x4341504E,
	NPOS_ID		= 0x534F504E,
	NPOT_ID		= 0x544F504E,
	NQUS_ID		= 0x5355514E,
	NQUT_ID		= 0x5455514E,
	NTOP_ID		= 0x504F544E,
	NTRM_ID		= 0x4D52544E,
	NVCI_ID		= 0x4943564E,
	NVER_ID		= 0x5245564E,
	NVMI_ID		= 0x494D564E,
	NVNM_ID		= 0x4D4E564E,
	NVPP_ID		= 0x5050564E,
	OBFL_ID		= 0x4C46424F,
	OBLT_ID		= 0x544C424F,
	OBML_ID		= 0x4C4D424F,
	OBND_ID		= 0x444E424F,
	OBTE_ID		= 0x4554424F,
	OBTF_ID		= 0x4654424F,
	OBTL_ID		= 0x4C54424F,
	OBTM_ID		= 0x4D54424F,
	OBTS_ID		= 0x5354424F,
	OCOR_ID		= 0x524F434F,
	OFST_ID		= 0x5453464F,
	ONAM_ID		= 0x4D414E4F,
	PCMB_ID		= 0x424D4350,
	PDTO_ID		= 0x4F544450,
	PERI_ID		= 0x4B524550,
	PFIG_ID		= 0x47494650,
	PFO2_ID		= 0x324F4650,
	PFOR_ID		= 0x524F4650,
	PFPC_ID		= 0x43504650,
	PFRN_ID		= 0x4E524650,
	PGAG_ID		= 0x47414750,
	PGRC_ID		= 0x52524750,
	PGRI_ID		= 0x49524750,
	PGRL_ID		= 0x4C524750,
	PGRP_ID		= 0x50524750,
	PHKV_ID		= 0x564B4850,
	PHTN_ID		= 0x4E544850,
	PHWT_ID		= 0x54574850,
	PKAM_ID		= 0x4D414B50,
	PKC2_ID		= 0x32434B50,
	PKCU_ID		= 0x55434B50,
	PKDD_ID		= 0x44444B50,
	PKDT_ID		= 0x54444B50,
	PKED_ID		= 0x44454B50,
	PKES_ID		= 0x32454B50,
	PKFD_ID		= 0x44464B50,
	PKID_ID		= 0x44494B50,
	PKND_ID		= 0x444E4B50,
	PKPT_ID		= 0x54504B50,
	PKW3_ID		= 0x33574B50,
	PLCN_ID		= 0x4E434C50,
	PLD2_ID		= 0x32444C50,
	PLDT_ID		= 0x54444C50,
	PLVD_ID		= 0x44564C50,
	PNAM_ID		= 0x4D414E50,
	POBA_ID		= 0x41424F50,
	POCA_ID		= 0x41434F50,
	POEA_ID		= 0x41454F50,
	PRCB_ID		= 0x42435250,
	PRKC_ID		= 0x434B5250,
	PRKE_ID		= 0x454B5250,
	PRKF_ID		= 0x464B5250,
	PRKL_ID		= 0x4C4B5250,
	PRKR_ID		= 0x524B5250,
	PRKZ_ID		= 0x5A4B5250,
	PROD_ID		= 0x444F5250,
	PRPS_ID		= 0x53505250,
	PSDT_ID		= 0x54445350,
	PT2A_ID		= 0x41325450,
	PTD2_ID		= 0x32445450,
	PTDA_ID		= 0x41445450,
	PTDT_ID		= 0x54445450,
	PTOP_ID		= 0x504F5450,
	PTRN_ID		= 0x4E525450,
	PUID_ID		= 0x44495550,
	QNAM_ID		= 0x4D414E51,
	QOBJ_ID		= 0x4A424F51,
	QSDT_ID		= 0x54445351,
	QSTA_ID		= 0x41545351,
	QSTI_ID		= 0x49545351,
	QSTR_ID		= 0x52545351,
	QTGL_ID		= 0x4C475451,
	QTOP_ID		= 0x504F5451,
	QUAL_ID		= 0x4C415551,
	RADR_ID		= 0x52444152,
	RAFB_ID		= 0x42464152,
	RAFD_ID		= 0x44464152,
	RAFL_ID		= 0x4C464152,
	RAFN_ID		= 0x4E464152,
	RAFS_ID		= 0x53464152,
	RAGA_ID		= 0x41474152,
	RAGN_ID		= 0x4E474152,
	RALH_ID		= 0x484C4152,
	RALN_ID		= 0x4E4C4152,
	RAPS_ID		= 0x53504152,
	RBPC_ID		= 0x43504252,
	RCEC_ID		= 0x43454352,
	RCIL_ID		= 0x4C494352,
	RCLR_ID		= 0x524C4352,
	RCOD_ID		= 0x444F4352,
	RCPR_ID		= 0x52504352,
	RCQY_ID		= 0x59514352,
	RCSR_ID		= 0x52534352,
	RCUN_ID		= 0x4E554352,
	RDAT_ID		= 0x54414452,
	RDGS_ID		= 0x53474452,
	RDLN_ID		= 0x4E4C4452,
	RDMD_ID		= 0x444D4452,
	RDMO_ID		= 0x4F4D4452,
	RDMP_ID		= 0x504D4452,
	RDOB_ID		= 0x424F4452,
	RDOJ_ID		= 0x4A4F4452,
	RDOT_ID		= 0x544F4452,
	RDSA_ID		= 0x41534452,
	RDSD_ID		= 0x44534452,
	RDWT_ID		= 0x54574452,
	REPL_ID		= 0x4C504552,
	REPT_ID		= 0x54504552,
	RLDM_ID		= 0x4D444C52,
	RNAM_ID		= 0x4D414E52,
	RNMV_ID		= 0x564D4E52,
	ROSE_ID		= 0x45534F52,
	RPLD_ID		= 0x444C5052,
	RPLI_ID		= 0x494C5052,
	RPRF_ID		= 0x46525052,
	RPRM_ID		= 0x4D525052,
	RVIS_ID		= 0x53495652,
	SADD_ID		= 0x44444153,
	SAKD_ID		= 0x444B4153,
	SAPT_ID		= 0x54504153,
	SCDA_ID		= 0x41444353,
	SCHR_ID		= 0x52484353,
	SCIT_ID		= 0x54494353,
	SCQS_ID		= 0x53514353,
	SCRD_ID		= 0x44524353,
	SCRI_ID		= 0x49524353,
	SCRO_ID		= 0x4F524353,
	SCRS_ID		= 0x53524353,
	SCRV_ID		= 0x56524353,
	SCTX_ID		= 0x58544353,
	SCVR_ID		= 0x52564353,
	SDSC_ID		= 0x43534453,
	SGNM_ID		= 0x4D4E4753,
	SHRT_ID		= 0x54524853,
	SIAD_ID		= 0x44414900,
	SLCP_ID		= 0x50434C53,
	SLCS_ID		= 0x53434C53,
	SLFD_ID		= 0x44464C53,
	SLLD_ID		= 0x444C4C53,
	SLSD_ID		= 0x44534C53,
	SLUD_ID		= 0x44554C53,
	SNAM_ID		= 0x4D414E53,
	SNDD_ID		= 0x44444E53,
	SNDX_ID		= 0x58444E53,
	SNMV_ID		= 0x564D4E53,
	SOFT_ID		= 0x54464F53,
	SOUL_ID		= 0x4C554F53,
	SPCT_ID		= 0x54435053,
	SPED_ID		= 0x44455053,
	SPIT_ID		= 0x54495053,
	SPLO_ID		= 0x4F4C5053,
	SPMV_ID		= 0x564D5053,
	SPOR_ID		= 0x524F5053,
	SRAC_ID		= 0x43415253,
	SRAF_ID		= 0x46415253,
	SSPN_ID		= 0x4E505353,
	STCP_ID		= 0x50435453,
	STKD_ID		= 0x444B5453,
	STOL_ID		= 0x4C4F5453,
	STOP_ID		= 0x504F5453,
	STPR_ID		= 0x52505453,
	STRV_ID		= 0x56525453,
	STSC_ID		= 0x43535453,
	SWMV_ID		= 0x564D5753,
	TCLF_ID		= 0x464C4354,
	TCLT_ID		= 0x544C4354,
	TEND_ID		= 0x444E4554,
	TETI_ID		= 0x49544554,
	TIAS_ID		= 0x53414954,
	TIFC_ID		= 0x43464954,
	TINC_ID		= 0x434E4954,
	TIND_ID		= 0x444E4954,
	TINI_ID		= 0x494E4954,
	TINL_ID		= 0x4C4E4954,
	TINP_ID		= 0x504E4954,
	TINT_ID		= 0x544E4954,
	TINV_ID		= 0x564E4954,
	TIQS_ID		= 0x53514954,
	TIRS_ID		= 0x53524954,
	TNAM_ID		= 0x4D414E54,
	TPIC_ID		= 0x43495054,
	TPLT_ID		= 0x544C5054,
	TPTA_ID		= 0x41545054,
	TRDA_ID		= 0x41445254,
	TRDT_ID		= 0x54445254,
	TSCE_ID		= 0x45435354,
	TTEB_ID		= 0x42455454,
	TTEC_ID		= 0x43455454,
	TTED_ID		= 0x44455454,
	TTEF_ID		= 0x46455454,
	TTEN_ID		= 0x50475454,
	TTET_ID		= 0x54455454,
	TTGE_ID		= 0x45475454,
	TTGP_ID		= 0x50475454,
	TVDT_ID		= 0x54445654,
	TWAT_ID		= 0x54415754,
	TX00_ID		= 0x30305854,
	TX01_ID		= 0x31305854,
	TX02_ID		= 0x32305854,
	TX03_ID		= 0x33305854,
	TX04_ID		= 0x34305854,
	TX05_ID		= 0x35305854,
	TX06_ID		= 0x36305854,
	TX07_ID		= 0x37305854,
	TX08_ID		= 0x38305854,
	TX09_ID		= 0x39305854,
	UNAM_ID		= 0x4D414E55,
	UNWP_ID		= 0x50574E55,
	VCLR_ID		= 0x524C4356,
	VENC_ID		= 0x434E4556,
	VEND_ID		= 0x444E4556,
	VENV_ID		= 0x564E4556,
	VHGT_ID		= 0x54474856,
	VISI_ID		= 0x49534956,
	VNAM_ID		= 0x4D414E56,
	VNML_ID		= 0x4C4D4E56,
	VTCK_ID		= 0x4B435456,
	VTXT_ID		= 0x54585456,
	WAIT_ID		= 0x54494157,
	WAMD_ID		= 0x444D4157,
	WBDT_ID		= 0x54444257,
	WCTR_ID		= 0x52544357,
	WHGT_ID		= 0x54474857,
	WIDX_ID		= 0x58444957,
	WKMV_ID		= 0x564D4B57,
	WLEV_ID		= 0x56454C57,
	WLST_ID		= 0x54534C57,
	WMAP_ID		= 0x50414D57,
	WNAM_ID		= 0x4D414E57,
	WTMX_ID		= 0x584D5457,
	WZMD_ID		= 0x444D5A57,
	XACR_ID		= 0x52434158,
	XACT_ID		= 0x54434158,
	XALP_ID		= 0x504C4158,
	XAMC_ID		= 0x434D4158,
	XAMT_ID		= 0x544D4158,
	XAPD_ID		= 0x44504158,
	XAPR_ID		= 0x52504158,
	XASP_ID		= 0x50534158,
	XATO_ID		= 0x4F544158,
	XATP_ID		= 0x50544158,
	XATR_ID		= 0x52544158,
	XBSD_ID		= 0x44534258,
	XCAS_ID		= 0x53414358,
	XCCM_ID		= 0x4D434358,
	XCET_ID		= 0x54454358,
	XCGD_ID		= 0x44474358,
	XCHG_ID		= 0x47484358,
	XCIM_ID		= 0x4D494358,
	XCLC_ID		= 0x434C4358,
	XCLL_ID		= 0x4C4C4358,
	XCLM_ID		= 0x4D4C4358,
	XCLR_ID		= 0x524C4358,
	XCLW_ID		= 0x574C4358,
	XCMO_ID		= 0x4F4D4358,
	XCMT_ID		= 0x544D4358,
	XCNT_ID		= 0x544E4358,
	XCRI_ID		= 0x49524358,
	XCVL_ID		= 0x4C564358,
	XCVR_ID		= 0x52564358,
	XCWT_ID		= 0x54574358,
	XCZA_ID		= 0x415A4358,
	XCZC_ID		= 0x435A4358,
	XCZR_ID		= 0x525A4358,
	XDCR_ID		= 0x52434458,
	XEDL_ID		= 0x4C444558,
	XEMI_ID		= 0x494D4558,
	XENC_ID		= 0x434E4558,
	XESP_ID		= 0x50534558,
	XEZN_ID		= 0x4E5A4558,
	XFVC_ID		= 0x43564658,
	XGDR_ID		= 0x52444758,
	XGLB_ID		= 0x424C4758,
	XHLP_ID		= 0x504C4858,
	XHLT_ID		= 0x544C4858,
	XHOR_ID		= 0x524F4858,
	XHRS_ID		= 0x53524858,
	XHTW_ID		= 0x57544858,
	XIBS_ID		= 0x53424958,
	XIDX_ID		= 0x58444958,
	XILL_ID		= 0x4C4C4958,
	XILW_ID		= 0x574C4958,
	XIS2_ID		= 0x32534958,
	XIVG_ID		= 0x47564958,
	XLCM_ID		= 0x4D434C58,
	XLCN_ID		= 0x4E434C58,
	XLCR_ID		= 0x504C4358,
	XLIB_ID		= 0x42494C58,
	XLIG_ID		= 0x47494C58,
	XLKR_ID		= 0x524B4C58,
	XLKT_ID		= 0x544B4C58,
	XLMB_ID		= 0x424D4C58,
	XLOC_ID		= 0x434F4C58,
	XLOD_ID		= 0x444F4C58,
	XLRL_ID		= 0x4C524C58,
	XLRM_ID		= 0x4D524C58,
	XLRT_ID		= 0x54524C58,
	XLTW_ID		= 0x57544C58,
	XLYR_ID		= 0x52594C58,
	XMBO_ID		= 0x4F424D58,
	XMBP_ID		= 0x50424D58,
	XMBR_ID		= 0x52424D58,
	XMRC_ID		= 0x43524D58,
	XMRK_ID		= 0x4B524D58,
	XMSP_ID		= 0x50534D58,
	XNAM_ID		= 0x4D414E58,
	XNDP_ID		= 0x50444E58,
	XNVP_ID		= 0x50564E58,
	XOCP_ID		= 0x50434F58,
	XORD_ID		= 0x44524F58,
	XOWN_ID		= 0x4E574F58,
	XPCI_ID		= 0x49435058,
	XPDD_ID		= 0x44445058,
	XPLK_ID		= 0x4B4C5058,
	XPOD_ID		= 0x444F5058,
	XPPA_ID		= 0x41505058,
	XPRD_ID		= 0x44525058,
	XPRI_ID		= 0x49525058,
	XPRM_ID		= 0x4D525058,
	XPSC_ID		= 0x43535058,
	XPSL_ID		= 0x4C535058,
	XPSN_ID		= 0x4E535058,
	XPTL_ID		= 0x4C545058,
	XPWR_ID		= 0x52575058,
	XRAD_ID		= 0x44415258,
	XRDO_ID		= 0x4F445258,
	XRDS_ID		= 0x53445258,
	XRFB_ID		= 0x42465258,
	XRFG_ID		= 0x47465258,
	XRGB_ID		= 0x42475258,
	XRGD_ID		= 0x44475258,
	XRMR_ID		= 0x524D5258,
	XRNK_ID		= 0x4B4E5258,
	XROO_ID		= 0x4F4F5258,
	XRTM_ID		= 0x4D545258,
	XSCL_ID		= 0x4C435358,
	XSED_ID		= 0x44455358,
	XSOL_ID		= 0x4C4F5358,
	XSPC_ID		= 0x43505358,
	XTEL_ID		= 0x4C455458,
	XTIM_ID		= 0x4D495458,
	XTNM_ID		= 0x4D4E5458,
	XTRI_ID		= 0x49525458,
	XUSE_ID		= 0x45535558,
	XWCD_ID		= 0x55435758,
	XWCN_ID		= 0x4E435758,
	XWCS_ID		= 0x53435758,
	XWEM_ID		= 0x4D455758,
	XWLT_ID		= 0x544C5758,
	XWNT_ID		= 0x544E5758,
	XWPG_ID		= 0x47505758,
	XWPN_ID		= 0x4E505758,
	XWSD_ID		= 0x44535758,
	XXXX_ID		= 0x58585858,
	YNAM_ID		= 0x4D414E59,
	ZNAM_ID		= 0x4D414E5A,
	_0TX_ID		= 0x58543030,
};

class TESFile {
public:
	TESFile(const char* apPath, const char* apFilename, NiFile::OpenMode aeAccessMode);
	TESFile(const char* apPath, const char* apFilename, NiFile::OpenMode aeAccessMode, uint32_t auiBufferSize);
	~TESFile();

	struct FormInfo {
		FormInfo() { ZeroMemory(this, sizeof(FormInfo)); }

		uint32_t	uiRecordType;
		uint32_t	uiDataSize;
		Bitfield32	uiFormFlags;
		uint32_t	uiFormID;
		uint32_t	uiVersionControl;
		uint16_t	usFormVersion;
		uint16_t	usVCVersion;
	};

	struct GroupInfo {
		FormInfo	kGroupInfo;
		uint32_t	uiGroupOffset;
	};

	struct FileHeader {
		FileHeader() : fVersion(1.34), uiRecordCount(0), uiNextFormID(0x800) {}

		float		fVersion;
		uint32_t	uiRecordCount;
		uint32_t	uiNextFormID;
	};

	enum Flags {
		MASTER			= 0x1,
		ALTERED			= 0x2,
		CHECKED			= 0x4,
		ACTIVE			= 0x8,
		OPTIMIZED		= 0x10,
		TEMP_ID_OWNER	= 0x20,
		ENDIAN_SWAPPED	= 0x40,
		LOCALIZED		= 0x80,
		SMALL			= 0x100,
		OVERLAY 		= 0x200,
	};

	uint32_t							eLastError;
	TESFile*							pThreadSafeParent;
	NiTPointerMap<uint32_t, TESFile*>*	pThreadSafeFileMap;
	BSFile*								pLockedFile;
	BSFile*								pFile;
	struct TESBitArrayFile*				pFormUserDataBitArray;
	struct TESBitArrayFile*				pFormVersionBitArray;
	struct TESBitArrayFile*				pFormIDBitArray;
	char								cFilename[260];
	char								cPath[260];
	char*								pBuffer;
	uint32_t							uiBufferAllocSize;
	uint32_t							uiFirstCellOffset;
	uint32_t							uiCurrCellOffset;
	TESObjectCELL*						pCurrCell;
	uint32_t							uiCurrRefOffset;
	FormInfo							kCurrentForm;
	CHUNK_ID							eCurrentChunkID;
	uint32_t							uiActualChunkSize;
	uint32_t							uiFileSize;
	uint32_t							uiFileOffset;
	uint32_t							uiFormOffset;
	uint32_t							uiChunkOffset;
	FormInfo							kSaveForm;
	uint32_t							uiSaveFormOffset;
	uint32_t							uiSaveChunkOffset;
	BSSimpleList<GroupInfo*>			kGroupList;
	bool								bHasGroups;
	bool								bIsBigEndian;
	bool								bForceCloseFiles;
	WIN32_FIND_DATA						kFileData;
	FileHeader							kHeader;
	Bitfield32							uiFlags;
	BSSimpleList<const char*>			kListMasters;
	BSSimpleList<const FILETIME*>		kMastersData;
	uint32_t							uiMasterCount;
	TESFile**							ppMasters;
	_FILETIME							kDeletedFormTime;
	uint8_t								ucCompileIndex;
	uint16_t							usSmallCompileIndex;
	BSStringT<char>						strAuthor;
	BSStringT<char>						strDescription;
	void*								pDecompressedFormBuffer;
	uint32_t							uiDecompressedFormBufferSize;
	bool								bMaybeShouldBeReloaded;

	const char* GetName() const { return cFilename; }

	TESFile* GetThreadSafeFile();

	uint8_t GetCompileIndex() const;
	void SetCompileIndex(uint8_t aucIndex);

	uint16_t GetSmallCompileIndex() const;
	void SetSmallCompileIndex(uint16_t ausIndex);

	bool IsMaster() const;
	void SetMaster(bool abMaster);

	bool IsChecked() const;
	void SetChecked(bool abChecked);

	bool IsActive() const;
	void SetActive(bool abActive);

	bool IsOptimized() const;
	void SetOptimized(bool abOptimized);

	bool IsLocalized() const;
	void SetLocalized(bool abDelocalized);

	bool IsSmallFile() const;
	void SetSmallFile(bool abSmallFile);

	bool IsOverlay() const;
	void SetOverlay(bool abOverlay);
};

ASSERT_SIZE(WIN32_FIND_DATA, 0x140);
ASSERT_SIZE(TESFile, 0x42C);

typedef TESFile ModInfo;